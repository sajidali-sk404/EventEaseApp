@page "/events/{EventId:guid}/register"
@using EventEase.Services
@inject UserSessionTracker Session
@inject NavigationManager Nav
@inject IEventService EventService

<EditForm Model="@registration" OnValidSubmit="HandleSubmit">
  <DataAnnotationsValidator />
  <ValidationSummary />

  <div>
    <label>Name:</label>
    <InputText @bind-Value="registration.Name" />
    <ValidationMessage For="@(() => registration.Name)" />
  </div>

  <div>
    <label>Email:</label>
    <InputText @bind-Value="registration.Email" />
    <ValidationMessage For="@(() => registration.Email)" />
  </div>

  <button type="submit">Register</button>
</EditForm>

@code {
  [Parameter] public Guid EventId { get; set; }

  private Registration registration = new();

  protected override void OnInitialized()
  {
    registration.EventId = EventId;
  }

  private async Task HandleSubmit()
  {
    await EventService.AddRegistration(EventId, registration);
    Session.CurrentUserName = registration.Name;
    Session.MyRegistrations.Add(registration);
    Nav.NavigateTo($"/events/{EventId}");
  }
}
